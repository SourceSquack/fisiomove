<div class="appointment-detail-container">
  <!-- Header -->
  <div class="header">
    <div class="title-section">
    <button class="btn-back" (click)="goBack()">
      <i class="fas fa-arrow-left"></i>
      <span>Volver a Citas</span>
    </button>
    <h1>Detalles de la Cita</h1>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
    <span>Cargando información de la cita...</span>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage && !isLoading" class="error-message">
    <i class="fas fa-exclamation-triangle"></i>
    <span>{{ errorMessage }}</span>
    <button class="btn-secondary" (click)="goBack()">Volver a Citas</button>
  </div>

  <!-- Appointment Details -->
  <div *ngIf="appointment && !isLoading" class="appointment-details">
    <!-- Main Information Card -->
    <div class="card">
      <div class="card-header">
        <div class="header-info">
          <h2>{{ getPatientFullName() }}</h2>
          <span
            class="status-badge"
            [style.background-color]="getStatusColor(appointment.status)"
          >
            {{ getStatusLabel(appointment.status) }}
          </span>
        </div>
        <button class="btn-primary" (click)="editAppointment()">
          <i class="fas fa-edit"></i>
          Editar Cita
        </button>
      </div>

      <div class="card-body">
        <div class="info-grid">
          <!-- Fecha y Hora -->
          <div class="info-section">
            <h3>
              <i class="fas fa-calendar-alt"></i>
              Fecha y Hora
            </h3>
            <div class="info-content">
              <p class="date">{{ formatDate(appointment.start_time) }}</p>
              <p class="time">{{ formatTime(appointment.start_time) }}</p>
              <p class="duration" *ngIf="appointment.duration_minutes">
                Duración: {{ appointment.duration_minutes }} minutos
              </p>
            </div>
          </div>

          <!-- Tipo de Cita -->
          <div class="info-section">
            <h3>
              <i class="fas fa-stethoscope"></i>
              Tipo de Cita
            </h3>
            <div class="info-content">
              <span class="type-badge">
                {{ getAppointmentTypeLabel(appointment.appointment_type) }}
              </span>
            </div>
          </div>

          <!-- Información del Paciente -->
          <div class="info-section">
            <h3>
              <i class="fas fa-user"></i>
              Información del Paciente
            </h3>
            <div class="info-content">
              <p><strong>Nombre:</strong> {{ getPatientFullName() }}</p>
              <p *ngIf="appointment?.patient?.email">
                <strong>Email:</strong> {{ appointment.patient!.email }}
              </p>
              <p *ngIf="appointment?.patient?.dni">
                <strong>DNI:</strong> {{ appointment.patient!.dni }}
              </p>
              <p *ngIf="appointment?.patient?.birth_date">
                <strong>Fecha de nacimiento:</strong>
                {{ appointment.patient!.birth_date | date : "dd/MM/yyyy" }}
              </p>
            </div>
          </div>

          <!-- Fisioterapeuta -->
          <div class="info-section" *ngIf="appointment?.physiotherapist">
            <h3>
              <i class="fas fa-user-md"></i>
              Fisioterapeuta asignado
            </h3>
            <div class="info-content">
              <p>
                <strong>Nombre:</strong>
                {{ appointment.physiotherapist!.full_name || "No asignado" }}
              </p>
              <p *ngIf="appointment.physiotherapist!.email">
                <strong>Email:</strong> {{ appointment.physiotherapist!.email }}
              </p>
            </div>
          </div>

          <!-- Sin Fisioterapeuta -->
          <div class="info-section" *ngIf="!appointment?.physiotherapist">
            <h3>
              <i class="fas fa-user-md"></i>
              Fisioterapeuta
            </h3>
            <div class="info-content">
              <p class="no-assignment">Pendiente de asignación</p>
            </div>
          </div>
        </div>

        <!-- Notas y Observaciones -->
        <div class="notes-section" *ngIf="appointment.notes">
          <h3>
            <i class="fas fa-sticky-note"></i>
            Notas y Observaciones
          </h3>
          <div class="notes-content">
            <p>{{ appointment.notes }}</p>
          </div>
        </div>

        <!-- Historial de Cambios -->
        <div class="history-section">
          <h3>
            <i class="fas fa-history"></i>
            Información de la cita
          </h3>
          <div class="history-content">
            <p *ngIf="appointment.created_at">
              <strong>Creada:</strong>
              {{ appointment.created_at | date : "dd/MM/yyyy HH:mm" }}
            </p>
            <p
              *ngIf="
                appointment.updated_at &&
                appointment.updated_at !== appointment.created_at
              "
            >
              <strong>Última actualización:</strong>
              {{ appointment.updated_at | date : "dd/MM/yyyy HH:mm" }}
            </p>
            <p><strong>ID de la cita:</strong> {{ appointment.id }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Actions -->
    <div class="actions-section">
      <button class="btn-secondary" (click)="goBack()">
        <i class="fas fa-arrow-left"></i>
        Volver a lista
      </button>
      <button class="btn-primary" (click)="editAppointment()">
        <i class="fas fa-edit"></i>
        Editar Cita
      </button>
    </div>
  </div>
</div>
