<div class="box">
  <div class="header-styled-container">
    <div class="header-styled-avatar">
      <div class="patient-avatar">
        <i class="fas fa-user"></i>
      </div>
      @if(!isLoading){
      <div>
        <h1 class="styled-patient-name">{{ patient?.full_name }}</h1>
        <span>
          <i class="fas fa-id-card"></i>
          {{ patient?.dni }}
        </span>
        -
        <span>
          <i class="fas fa-envelope"></i>
          {{ patient?.email }}
        </span>
      </div>
      }
    </div>
    <div class="styled-header-buttons">
      @if(isLoading){
      <div class="header-loader">
        <i class="fas fa-spinner fa-spin"></i>
        Cargando información del paciente
      </div>
      }@else {
      <button (click)="goBack()">
        <span class="icon is-small"> <i class="fas fa-arrow-left"></i></span>
        <span> Volver </span>
      </button>
      @if(isEditing) {
      <button class="button is-link is-light" (click)="toggleEdit()">
        <span class="icon is-small"> <i class="fas fa-times"></i> </span>
        <span> Cancelar </span>
      </button>
      }@else{
      <button class="button is-link" (click)="toggleEdit()">
        <span class="icon is-small"> <i class="fas fa-edit"></i> </span>
        <span> Editar </span>
      </button>
      } }
    </div>
  </div>
</div>

@if(isLoading) {
<div class="loading-state">
  <i class="fas fa-spinner fa-spin"></i>
  <span>Cargando información del paciente</span>
</div>
}

<!-- Contenido del paciente -->
@if (!isLoading && !error && patient) {

<!-- panel de información del paciente -->
@if(!isEditing) {
<div class="box"></div>
}

<!-- panel de edición de información del paciente -->
@if (isEditing) {
<!-- <div class="patient-edit-panel"> -->
<div class="box">
  <form [formGroup]="patientForm" (ngSubmit)="onSubmit()">
    <div class="form-row">
      <div class="form-group">
        <label for="full_name">
          <i class="fas fa-user"></i>
          Nombre completo *
        </label>
        <input
          type="text"
          id="full_name"
          formControlName="full_name"
          class="form-control"
          placeholder="Ingrese el nombre completo"
        />
        @if (isFieldInvalid('full_name')) {
        <span class="error-message"> El nombre completo es requerido </span>
        }
      </div>

      <div class="form-group">
        <label for="email">
          <i class="fas fa-envelope"></i>
          Email *
        </label>
        <input
          type="email"
          id="email"
          formControlName="email"
          class="form-control"
          placeholder="ejemplo@correo.com"
        />
        @if (isFieldInvalid('email')) {
        <span class="error-message">
          El email es requerido y debe ser válido
        </span>
        }
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="dni">
          <i class="fas fa-id-card"></i>
          DNI *
        </label>
        <input
          type="text"
          id="dni"
          formControlName="dni"
          class="form-control"
          placeholder="Número de documento"
        />
        @if (isFieldInvalid('dni')) {
        <span class="error-message"> El DNI es requerido </span>
        }
      </div>

      <div class="form-group">
        <label for="birth_date">
          <i class="fas fa-birthday-cake"></i>
          Fecha de nacimiento
        </label>
        <input
          type="date"
          id="birth_date"
          formControlName="birth_date"
          class="form-control"
        />
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="gender">
          <i class="fas fa-venus-mars"></i>
          Género
        </label>
        <select id="gender" formControlName="gender" class="form-control">
          <option value="">Seleccionar género</option>
          <option value="masculino">Masculino</option>
          <option value="femenino">Femenino</option>
          <option value="otro">Otro</option>
        </select>
      </div>

      <div class="form-group">
        <label for="emergency_contact">
          <i class="fas fa-phone-alt"></i>
          Contacto de emergencia
        </label>
        <input
          type="text"
          id="emergency_contact"
          formControlName="emergency_contact"
          class="form-control"
          placeholder="Nombre y teléfono de contacto"
        />
      </div>
    </div>

    <div class="form-group full-width">
      <label for="address">
        <i class="fas fa-map-marker-alt"></i>
        Dirección
      </label>
      <textarea
        id="address"
        formControlName="address"
        class="form-control"
        rows="2"
        placeholder="Dirección completa..."
      ></textarea>
    </div>

    <div class="field is-grouped is-grouped-right">
      <p class="control">
        <button class="button is-link is-light" (click)="toggleEdit()">
          <span class="icon is-small"> <i class="fas fa-times"></i> </span>
          <span> Cancelar </span>
        </button>
      </p>
      <p class="control">
        <button
          class="button is-link"
          (click)="onSubmit()"
          [disabled]="isSaving || patientForm.invalid"
        >
          <i class="fas fa-save"></i>
          @if (isSaving) {
          <span>Guardando</span>
          } @else{
          <span>Guardar</span>
          }
        </button>
      </p>
    </div>
  </form>
</div>
} }
