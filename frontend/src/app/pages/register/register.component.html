<div class="register-container">
  <div class="register-card">
    <img src="assets/logo.png" alt="Fisiomove Logo" class="register-logo" />
    <h2>Únete a Fisiomove</h2>
    <p class="subtitle">Comienza tu camino hacia el bienestar</p>
    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
      <!-- Mostrar mensajes de error o éxito -->
      @if (errorMessage) {
      <div class="error-message">
        <i class="fas fa-exclamation-triangle"></i>
        {{ errorMessage }}
      </div>
      } @if (successMessage) {
      <div class="success-message">
        <i class="fas fa-check-circle"></i>
        {{ successMessage }}
      </div>
      }

      <div class="name-group">
        <div class="form-group">
          <label for="firstName">Nombre</label>
          <div class="input-group">
            <span class="input-icon"><i class="fas fa-user"></i></span>
            <input
              type="text"
              id="firstName"
              formControlName="firstName"
              placeholder="Juan"
              [class.error]="firstName?.invalid && firstName?.touched"
            />
          </div>
          @if (firstName?.invalid && firstName?.touched) {
          <div class="field-error">
            @if (firstName?.errors?.['required']) { El nombre es requerido } @if
            (firstName?.errors?.['minlength']) { El nombre debe tener al menos 2
            caracteres }
          </div>
          }
        </div>
        <div class="form-group">
          <label for="lastName">Apellido</label>
          <div class="input-group">
            <span class="input-icon"><i class="fas fa-user"></i></span>
            <input
              type="text"
              id="lastName"
              formControlName="lastName"
              placeholder="Pérez"
              [class.error]="lastName?.invalid && lastName?.touched"
            />
          </div>
          @if (lastName?.invalid && lastName?.touched) {
          <div class="field-error">
            @if (lastName?.errors?.['required']) { El apellido es requerido }
            @if (lastName?.errors?.['minlength']) { El apellido debe tener al
            menos 2 caracteres }
          </div>
          }
        </div>
      </div>

      <div class="form-group">
        <label for="email">Correo electrónico</label>
        <div class="input-group">
          <span class="input-icon"><i class="fas fa-envelope"></i></span>
          <input
            type="email"
            id="email"
            formControlName="email"
            placeholder="tu@email.com"
            [class.error]="email?.invalid && email?.touched"
          />
        </div>
        @if (email?.invalid && email?.touched) {
        <div class="field-error">
          @if (email?.errors?.['required']) { El correo electrónico es requerido
          } @if (email?.errors?.['email']) { Ingresa un correo electrónico
          válido }
        </div>
        }
      </div>

      <div class="form-group">
        <label for="phone">Teléfono</label>
        <div class="input-group">
          <span class="input-icon"><i class="fas fa-phone"></i></span>
          <input
            type="tel"
            id="phone"
            formControlName="phone"
            placeholder="+57 300 123 4567"
            [class.error]="phone?.invalid && phone?.touched"
          />
        </div>
        @if (phone?.invalid && phone?.touched) {
        <div class="field-error">
          @if (phone?.errors?.['required']) { El teléfono es requerido } @if
          (phone?.errors?.['pattern']) { Ingresa un número de teléfono válido }
        </div>
        }
      </div>

      <div class="form-group">
        <label for="password">Contraseña</label>
        <div class="input-group">
          <span class="input-icon"><i class="fas fa-lock"></i></span>
          <input
            [type]="showPassword ? 'text' : 'password'"
            id="password"
            formControlName="password"
            placeholder="********"
            [class.error]="password?.invalid && password?.touched"
          />
          <span class="input-icon-right" (click)="togglePasswordVisibility()" (keydown)="togglePasswordVisibility()">
            <i [class]="showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
          </span>
        </div>
        @if (password?.invalid && password?.touched) {
        <div class="field-error">
          @if (password?.errors?.['required']) { La contraseña es requerida }
          @if (password?.errors?.['minlength']) { La contraseña debe tener al
          menos 8 caracteres }
        </div>
        }
      </div>

      <div class="form-group">
        <label for="confirmPassword">Confirmar contraseña</label>
        <div class="input-group">
          <span class="input-icon"><i class="fas fa-lock"></i></span>
          <input
            [type]="showConfirmPassword ? 'text' : 'password'"
            id="confirmPassword"
            formControlName="confirmPassword"
            placeholder="********"
            [class.error]="(confirmPassword?.invalid && confirmPassword?.touched) || (registerForm.errors?.['passwordMismatch'] && confirmPassword?.touched)"
          />
          <span
            class="input-icon-right"
            (click)="toggleConfirmPasswordVisibility()"
            (keydown)="toggleConfirmPasswordVisibility()"
          >
            <i
              [class]="showConfirmPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"
            ></i>
          </span>
        </div>
        @if (confirmPassword?.invalid && confirmPassword?.touched) {
        <div class="field-error">
          @if (confirmPassword?.errors?.['required']) { Confirma tu contraseña }
        </div>
        } @if (registerForm.errors?.['passwordMismatch'] &&
        confirmPassword?.touched) {
        <div class="field-error">Las contraseñas no coinciden</div>
        }
      </div>

      <div class="form-group terms-group">
        <input type="checkbox" id="terms" formControlName="terms" />
        <label for="terms" [class.error]="terms?.invalid && terms?.touched">
          Acepto los términos y condiciones
        </label>
        <p>
          Acepto los
          <b
            class="text-link"
            (click)="changeStatusTermsModal()"
            (keydown)="changeStatusTermsModal()"
          >
            términos de servicio
          </b>
          y la
          <b
            class="text-link"
            (click)="changeStatusPrivacyModal()"
            (keydown)="changeStatusPrivacyModal()"
          >
            política de privacidad.
          </b>
        </p>
        @if (terms?.invalid && terms?.touched) {
        <div class="field-error">Debes aceptar los términos y condiciones</div>
        }
      </div>

      <button
        type="submit"
        class="button is-link is-fullwidth"
        [disabled]="isLoading"
        [class.loading]="isLoading"
      >
        @if (isLoading) {
        <i class="fas fa-spinner fa-spin"></i>
        Creando cuenta} @else { Crear cuenta }
      </button>
    </form>
    <p class="login-link">
      ¿Ya tienes una cuenta? <a routerLink="/login">Inicia sesión</a>
    </p>
  </div>
</div>

<!-- Modal: Términos de servicio -->
<div [ngClass]="'modal' + (termsModalisActive ? ' is-active' : '')">
  <div class="modal-background"></div>
  <div class="modal-content">
    <div class="card">
      <div class="card-content">
        <p class="title">Términos de servicio</p>
        <p>
          Lorem ipsum dolor sit amet consectetur, adipisicing elit. Nam,
          possimus quisquam! Temporibus repellendus non itaque accusantium,
          culpa architecto. Repellendus ea minus nobis nostrum nisi deserunt
          numquam adipisci magni, quasi optio.
        </p>
        <br />
        <div class="has-text-centered">
          <button
            class="delete"
            aria-label="close"
            (click)="changeStatusTermsModal()"
          ></button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal: Política de privacidad -->
<div [ngClass]="'modal' + (privacyModalisActive ? ' is-active' : '')">
  <div class="modal-background"></div>
  <div class="modal-content">
    <div class="card">
      <div class="card-content">
        <p class="title">Política de privacidad</p>
        <p>
          Lorem ipsum dolor sit amet consectetur, adipisicing elit. Nam,
          possimus quisquam! Temporibus repellendus non itaque accusantium,
          culpa architecto. Repellendus ea minus nobis nostrum nisi deserunt
          numquam adipisci magni, quasi optio.
        </p>
        <br />
        <div class="has-text-centered">
          <button
            class="delete"
            aria-label="close"
            (click)="changeStatusPrivacyModal()"
          ></button>
        </div>
      </div>
    </div>
  </div>
</div>
